{"version":3,"file":"Signin.js","sources":["../src/views/Signin.vue"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\n<template>\n  <div class=\"view entry signin\">\n    <p class=\"welcome\">Welcome Back</p>\n    <p class=\"hint\">\n      Don't have any account yet?\n      <span @click=\"goToRegister\">Register here</span>\n    </p>\n    <div class=\"form\">\n      <form @submit.prevent=\"onSubmit\">\n        <div class=\"group\">\n          <label for=\"login_email\">email</label>\n          <span\n            class=\"input-icon\"\n            :class=\"{ 'has-error': email.errorMessage.value }\"\n          >\n            <input\n              id=\"login_email\"\n              v-model=\"email.value.value\"\n              type=\"email\"\n              name=\"email\"\n            />\n            <icon class=\"icon\" data=\"@/assets/svg-icon/mail.svg?icon\" />\n          </span>\n          <div v-if=\"email.errorMessage.value\" class=\"error\">\n            {{ email.errorMessage.value }}\n          </div>\n        </div>\n        <div class=\"group\">\n          <label for=\"login_password\">password</label>\n          <span\n            class=\"input-icon\"\n            :class=\"{ 'has-error': password.errorMessage.value }\"\n          >\n            <input\n              id=\"login_password\"\n              v-model=\"password.value.value\"\n              :type=\"showPassword ? 'text' : 'password'\"\n              name=\"password\"\n            />\n            <icon\n              class=\"icon toggle\"\n              :data=\"getPasswordIcon(showPassword)\"\n              @click=\"showPassword = !showPassword\"\n            />\n          </span>\n          <div v-if=\"password.errorMessage.value\" class=\"error\">\n            {{ password.errorMessage.value }}\n          </div>\n        </div>\n        <div class=\"prompt\">\n          Signing in or logging in the platform, you automatically accept our\n          <span class=\"highlight\">privacy</span> and\n          <span class=\"highlight\">Terms and Conditions</span>\n        </div>\n        <div class=\"remember_me\">\n          <input type=\"checkbox\" name=\"\" id=\"\" />\n          <span>Remember me</span>\n        </div>\n        <button class=\"btn_signin\">Sign in</button>\n      </form>\n      <div class=\"forget_password\">Forget your password?</div>\n    </div>\n  </div>\n</template>\n<script lang=\"ts\" setup>\nimport { useForm, useField } from \"vee-validate\";\nimport { getPasswordIcon } from \"@/utils/helpers\";\nimport { object, string, boolean } from \"yup\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport { useReCaptcha } from \"vue-recaptcha-v3\";\nimport { get } from \"lodash-es\";\nimport { HTTPError, TimeoutError } from \"ky-universal\";\nimport { ref } from \"vue\";\nimport { getModule } from \"vuex-module-decorators\";\nimport User from \"@/store/modules/User\";\nimport { store } from \"@/store\";\nimport { isDevelopment, isProduction } from \"@/utils/helpers\";\nimport {\n  isErrorResponse,\n  isValidationErrorResponse,\n  hasLoggedInResponse,\n  isAuthorizationError,\n} from \"@/types/logged\";\nimport { api } from \"@/utils/requests\";\nimport { nprogress } from \"@/main\";\n\nconst validationSchema = object({\n  email: string()\n    .email(\"Please input a valid email address\")\n    .required(\"Please input a valid email address\"),\n  password: string().required(\"Please input a valid password\"),\n  keepMeLogged: boolean(),\n});\n\nconst form = useForm({\n  validationSchema,\n  initialValues: {\n    email: \"\",\n    password: \"\",\n  },\n});\n\nconst email = useField(\"email\", undefined, {\n  validateOnValueUpdate: true,\n});\nconst password = useField(\"password\", undefined, {\n  validateOnValueUpdate: true,\n});\n\nconst showPassword = ref(false);\n\nconst toastId = ref(\"login\");\nconst toast = useToast();\nconst user = getModule(User, store);\nconst recaptcha = useReCaptcha();\nconst router = useRouter();\nconst isSaving = ref(false);\nconst goToRegister = () => {\n  router.push({ name: \"register\" });\n};\n\nconst onSubmit = async (e: Event) => {\n  e.preventDefault();\n\n  if (isSaving.value) return;\n  const { valid } = await form.validate();\n\n  if (!valid) {\n    toast.error(\"Ooops... invalid login credentials\", {\n      timeout: 7000,\n      id: toastId.value,\n    });\n\n    return;\n  }\n\n  if (\n    !(\n      isDevelopment ||\n      (isProduction && recaptcha && (await recaptcha.recaptchaLoaded()))\n    )\n  ) {\n    toast.error(\n      \"Oops! Cannot submit request at this time.. Please refresh this page\",\n      {\n        id: toastId.value,\n        timeout: 5000,\n      }\n    );\n\n    return false;\n  }\n\n  isSaving.value = true;\n  toast.info(\"Logging user...\", {\n    id: toastId.value,\n    timeout: 0,\n  });\n\n  try {\n    const token = isProduction\n      ? await recaptcha?.executeRecaptcha(\"login\")\n      : \"token\";\n\n    const response = await api.post(\"login\", {\n      json: {\n        ...form.values,\n        \"g-captcha-key\": token,\n      },\n    });\n\n    if (response.status === 200) {\n      const data = (await response.json()) as Record<string, unknown>;\n\n      if (hasLoggedInResponse(data)) {\n        nprogress.isLoading.value = true;\n\n        await user.setToken(data.data.token);\n        await user.setState({ userData: data.data.user });\n        toast.success(\"User logged successfully\", {\n          id: toastId.value,\n          timeout: 3500,\n        });\n\n        await user.goToDashboard();\n        return;\n      }\n    } else {\n      toast.error(\"Please refresh this page...\", {\n        id: toastId.value,\n        timeout: 4000,\n      });\n    }\n  } catch (e: unknown) {\n    toast.dismiss(toastId.value);\n    if (!e) window.location.reload();\n\n    (async () => {\n      if (e instanceof HTTPError) {\n        const status = get(e, \"response.status\");\n        console.log(\"status\", status);\n        if (status >= 400) {\n          const errResp = await e.response.json();\n          console.log(\"status\", status);\n          if (isValidationErrorResponse(errResp)) {\n            toast.error(errResp.message, {\n              id: toastId.value,\n              timeout: 4000,\n            });\n          } else if (isErrorResponse(errResp)) {\n            return toast.error(errResp.error.message, {\n              id: toastId.value,\n            });\n          } else if (isAuthorizationError(errResp)) {\n            return toast.error(\"Authorization Error\", {\n              id: toastId.value,\n            });\n          }\n        }\n      } else if (e instanceof TimeoutError) {\n        return toast.error(\n          \"Oops! An error occured while sending request. Please check your internet connection\",\n          {\n            id: toastId.value,\n          }\n        );\n      } else {\n        toast.error(\"An error occurred while logging in user\", {\n          id: toastId.value,\n        });\n      }\n    })();\n  }\n\n  isSaving.value = false;\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@use \"@/assets/scss/colors.scss\" as color;\n@use \"sass:color\" as sasscolor;\n@use \"@/assets/scss/_breakpoints.scss\" as breakpoint;\n.view.entry.signin {\n  width: 70%;\n  margin: 0 auto;\n  padding: 250px 0 0 30px;\n  > .welcome {\n    color: color.$darker-black;\n    font-size: 35px;\n    font-weight: bolder;\n    margin-top: 20px;\n  }\n\n  > .hint {\n    font-size: 14px;\n    color: color.$text-black-0;\n    cursor: pointer;\n    > span {\n      color: #696cf1;\n    }\n  }\n\n  > .form {\n    width: 100%;\n\n    > form {\n      width: 100%;\n      flex-direction: column;\n      align-items: center;\n\n      @include breakpoint.respond-below(sm) {\n        margin: 0;\n      }\n\n      > * {\n        display: flex;\n        width: 100%;\n        margin: 30px 0 0 0;\n      }\n\n      > .create {\n        justify-content: center;\n        color: color.$black-1;\n        border-radius: 10px;\n        font-size: 14px;\n        white-space: nowrap;\n\n        > .link {\n          display: inline-flex;\n          margin: 0 0 0 5px;\n          color: color.$brown-1;\n          text-decoration: none;\n        }\n      }\n\n      > .group {\n        flex-direction: column;\n\n        > * {\n          display: flex;\n          width: 100%;\n          justify-content: flex-start;\n        }\n\n        > label {\n          margin: 0;\n          font-weight: normal;\n          text-transform: capitalize;\n          font-size: 14px;\n          font-weight: 600;\n\n          @include breakpoint.respond-below(sm) {\n            font-size: 16px;\n          }\n        }\n\n        > .input-icon {\n          border: none;\n          position: relative;\n          align-items: center;\n          margin: 6px 0 0 0;\n\n          > input {\n            width: 100%;\n            height: 50px;\n            padding: 0 0 0 30px;\n            font-size: 13px;\n            color: color.$ash-1;\n            border: 1px solid rgba(color.$ash-7, 0.8);\n            border-radius: 7px;\n            transition: all 0.3s ease-in-out;\n            outline: initial;\n\n            &:focus {\n              box-shadow: 1px 1px 5px 0 rgba(color.$ash-1, 0.4);\n            }\n          }\n\n          > .icon {\n            width: 20px;\n            height: 20px;\n            position: absolute;\n            right: 30px;\n            color: color.$ash-2;\n            transition: all 0.3s ease-in-out;\n\n            &.toggle {\n              cursor: pointer;\n            }\n          }\n\n          &.has-error {\n            > input {\n              border-color: color.$red-1;\n            }\n\n            > .icon {\n              color: color.$red-1;\n            }\n          }\n        }\n\n        > .error {\n          display: flex;\n          width: 100%;\n          justify-content: flex-start;\n          align-items: center;\n          font-size: 12px;\n          font-weight: normal;\n          color: color.$red-1;\n          margin: 8px 0 0 0;\n          flex-wrap: wrap;\n        }\n      }\n\n      > .information {\n        width: 100%;\n        background-color: color.$ash-3;\n        font-size: 13px;\n        justify-content: center;\n        align-items: center;\n        text-align: center;\n        color: color.$ash-1;\n        padding: 10px 20px;\n        flex-wrap: wrap;\n\n        > a {\n          margin: 0 5px;\n          color: color.$main-green;\n        }\n      }\n\n      > .prompt {\n        font-size: 13px;\n        display: block;\n        > .highlight {\n          color: color.$purple;\n        }\n      }\n\n      > .btn_signin {\n        width: 100%;\n        margin: 40px 0 0 0;\n        justify-content: center;\n        align-items: center;\n        background-color: color.$main-green;\n        color: #fff;\n        border-radius: 10px;\n        font-size: 17px;\n        white-space: nowrap;\n        text-transform: capitalize;\n        padding: 15px;\n        outline: initial;\n        border: initial;\n        transition: all 0.3s ease-in-out;\n        cursor: pointer;\n\n        &:hover:not(:disabled) {\n          box-shadow: 1px 1px 5px 0 color.$ash-1;\n        }\n\n        @include breakpoint.respond-below(msl) {\n          width: 100%;\n          font-size: 16px;\n        }\n\n        @include breakpoint.respond-below(sm) {\n          font-size: 16px;\n        }\n      }\n    }\n\n    > .forget_password {\n      margin-top: 30px;\n      width: 100%;\n      text-align: center;\n      color: #696cf1;\n      font-size: 15px;\n      font-weight: 600;\n      cursor: pointer;\n    }\n  }\n}\n</style>\n"],"names":["validationSchema","object","string","boolean","form","useForm","email","useField","password","showPassword","ref","toastId","toast","useToast","user","getModule","User","store","recaptcha","useReCaptcha","router","useRouter","isSaving","goToRegister","onSubmit","e","valid","isDevelopment","isProduction","token","response","api","data","hasLoggedInResponse","nprogress","HTTPError","status","get","errResp","isValidationErrorResponse","isErrorResponse","isAuthorizationError","TimeoutError"],"mappings":"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"}